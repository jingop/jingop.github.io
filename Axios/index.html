<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue中axios的封装 | liu.Sir</title>
    <meta name="description" content="欢迎来到我的博客">
    
    
    <link rel="preload" href="/assets/css/0.styles.dc197310.css" as="style"><link rel="preload" href="/assets/js/app.47140048.js" as="script"><link rel="preload" href="/assets/js/2.060d339d.js" as="script"><link rel="preload" href="/assets/js/5.5167bf59.js" as="script"><link rel="prefetch" href="/assets/js/10.bd5970ec.js"><link rel="prefetch" href="/assets/js/11.5c0d04e4.js"><link rel="prefetch" href="/assets/js/12.03c10f19.js"><link rel="prefetch" href="/assets/js/13.56f48fb6.js"><link rel="prefetch" href="/assets/js/14.53d8d9de.js"><link rel="prefetch" href="/assets/js/3.f9135ee0.js"><link rel="prefetch" href="/assets/js/4.badc7383.js"><link rel="prefetch" href="/assets/js/6.65d2a5d6.js"><link rel="prefetch" href="/assets/js/7.f0720171.js"><link rel="prefetch" href="/assets/js/8.3ad1787e.js"><link rel="prefetch" href="/assets/js/9.71aaf8de.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dc197310.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">liu.Sir</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/introduce/" class="nav-link">VuePress</a></div><div class="nav-item"><a href="/web/" class="nav-link">web</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jszj/" class="nav-link">js中级</a></li><li class="dropdown-item"><!----> <a href="/jsgj/" class="nav-link">js高级</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jingop/jingop.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/introduce/" class="nav-link">VuePress</a></div><div class="nav-item"><a href="/web/" class="nav-link">web</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jszj/" class="nav-link">js中级</a></li><li class="dropdown-item"><!----> <a href="/jsgj/" class="nav-link">js高级</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jingop/jingop.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VuePress </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vuex </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Axios </span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Axios/" class="active sidebar-link">vue中axios的封装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Axios/#axios的封装" class="sidebar-link">axios的封装</a></li><li class="sidebar-sub-header"><a href="/Axios/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/Axios/#引入" class="sidebar-link">引入</a></li><li class="sidebar-sub-header"><a href="/Axios/#环境的切换" class="sidebar-link">环境的切换</a></li><li class="sidebar-sub-header"><a href="/Axios/#设置请求超时" class="sidebar-link">设置请求超时</a></li><li class="sidebar-sub-header"><a href="/Axios/#post请求头的设置" class="sidebar-link">post请求头的设置</a></li><li class="sidebar-sub-header"><a href="/Axios/#请求拦截" class="sidebar-link">请求拦截</a></li><li class="sidebar-sub-header"><a href="/Axios/#响应的拦截" class="sidebar-link">响应的拦截</a></li><li class="sidebar-sub-header"><a href="/Axios/#封装get方法和post方法" class="sidebar-link">封装get方法和post方法</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue中axios的封装"><a href="#vue中axios的封装" aria-hidden="true" class="header-anchor">#</a> vue中axios的封装</h1> <h2 id="axios的封装"><a href="#axios的封装" aria-hidden="true" class="header-anchor">#</a> axios的封装</h2> <blockquote><p>在vue项目中，和后台交互获取数据这块，我们通常使用的是axios库，它是基于promise的http库，可运行在浏览器端和node.js中。他有很多优秀的特性，例如拦截请求和响应、取消请求、转换json、客户端防御cSRF等。所以我们的尤大大也是果断放弃了对其官方库vue-resource的维护，直接推荐我们使用axios库。如果还对axios不了解的，可以移步<a href="https://www.npmjs.com/package/axios" target="_blank" rel="noopener noreferrer">axios文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <pre><code>npm install axios;
</code></pre> <h2 id="引入"><a href="#引入" aria-hidden="true" class="header-anchor">#</a> 引入</h2> <blockquote><p>一般我会在项目的src目录中，新建一个request文件夹，然后在里面新建一个http.js和一个api.js文件。
http.js文件用来封装我们的axios，api.js用来统一管理我们的接口。</p></blockquote> <blockquote><p>// 在http.js中引入axios</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span> <span class="token comment">// 引入axios</span>
    <span class="token keyword">import</span> <span class="token constant">QS</span> <span class="token keyword">from</span> <span class="token string">'qs'</span><span class="token punctuation">;</span> <span class="token comment">// 引入qs模块，用来序列化post类型的数据，后面会提到</span>
    <span class="token comment">// vant的toast提示框组件，大家可根据自己的ui组件更改。</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Toast <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vant'</span><span class="token punctuation">;</span>   
</code></pre></div><h2 id="环境的切换"><a href="#环境的切换" aria-hidden="true" class="header-anchor">#</a> 环境的切换</h2> <blockquote><p>我们的项目环境可能有开发环境、测试环境和生产环境。我们通过node的环境变量来匹配我们的默认的接口url前缀。axios.defaults.baseURL可以设置axios的默认请求地址就不多说了。</p></blockquote> <blockquote><p>环境的切换</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
       axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'debug'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'https://www.ceshi.com'</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
   axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'https://www.production.com'</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre></div><h2 id="设置请求超时"><a href="#设置请求超时" aria-hidden="true" class="header-anchor">#</a> 设置请求超时</h2> <blockquote><p>通过axios.defaults.timeout设置默认的请求超时时间。例如超过了10s，就会告知用户当前请求超时，请刷新等。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>   axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="post请求头的设置"><a href="#post请求头的设置" aria-hidden="true" class="header-anchor">#</a> post请求头的设置</h2> <blockquote><p>post请求的时候，我们需要加上一个请求头，所以可以在这里进行一个默认的设置，即设置post的请求头为application/x-www-form-urlencoded;charset=UTF-8</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>   axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>post<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> '
   application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded<span class="token punctuation">;</span>charset<span class="token operator">=</span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span>'<span class="token punctuation">;</span>
</code></pre></div><ul><li>请求拦截</li></ul> <blockquote><p>我们在发送请求前可以进行一个请求的拦截，为什么要拦截呢，我们拦截请求是用来做什么的呢？比如，有些请求是需要用户登录之后才能访问的，或者post请求的时候，我们需要序列化我们提交的数据。这时候，我们可以在请求被发送之前进行一个拦截，从而进行我们想要的操作。</p></blockquote> <h2 id="请求拦截"><a href="#请求拦截" aria-hidden="true" class="header-anchor">#</a> 请求拦截</h2> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// 先导入vuex,因为我们要使用到里面的状态对象</span>
   <span class="token comment">// vuex的路径根据自己的路径去写</span>
   <span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store/index'</span><span class="token punctuation">;</span>

   <span class="token comment">// 请求拦截器axios.interceptors.request.use(    </span>
       <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        
           <span class="token comment">// 每次发送请求之前判断vuex中是否存在token        </span>
           <span class="token comment">// 如果存在，则统一在http请求的header都加上token，这样后台根据token判断你的登录情况</span>
           <span class="token comment">// 即使本地存在token，也有可能token是过期的，所以在响应拦截器中要对返回状态进行判断 </span>
           <span class="token keyword">const</span> token <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>token<span class="token punctuation">;</span>        
           token <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>        
           <span class="token keyword">return</span> config<span class="token punctuation">;</span>    
       <span class="token punctuation">}</span><span class="token punctuation">,</span>    
       <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        
           <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>    
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="响应的拦截"><a href="#响应的拦截" aria-hidden="true" class="header-anchor">#</a> 响应的拦截</h2> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// 响应拦截器</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>    
   <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   
       <span class="token comment">// 如果返回的状态码为200，说明接口请求成功，可以正常拿到数据     </span>
       <span class="token comment">// 否则的话抛出错误</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            
           <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            
           <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        
       <span class="token punctuation">}</span>    
   <span class="token punctuation">}</span><span class="token punctuation">,</span>    
   <span class="token comment">// 服务器状态码不是2开头的的情况</span>
   <span class="token comment">// 这里可以跟你们的后台开发人员协商好统一的错误状态码    </span>
   <span class="token comment">// 然后根据返回的状态码进行一些操作，例如登录过期提示，错误提示等等</span>
   <span class="token comment">// 下面列举几个常见的操作，其他需求可自行扩展</span>
   <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            
       <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>            
           <span class="token keyword">switch</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
               <span class="token comment">// 401: 未登录</span>
               <span class="token comment">// 未登录则跳转登录页面，并携带当前页面的路径</span>
               <span class="token comment">// 在登录成功后返回当前页面，这一步需要在登录页操作。                </span>
               <span class="token keyword">case</span> <span class="token number">401</span><span class="token punctuation">:</span>                    
                   router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                        
                       path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>                        
                       query<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
                           redirect<span class="token punctuation">:</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath 
                       <span class="token punctuation">}</span>
                   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>

               <span class="token comment">// 403 token过期</span>
               <span class="token comment">// 登录过期对用户进行提示</span>
               <span class="token comment">// 清除本地token和清空vuex中token对象</span>
               <span class="token comment">// 跳转登录页面                </span>
               <span class="token keyword">case</span> <span class="token number">403</span><span class="token punctuation">:</span>
                    <span class="token function">Toast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                       message<span class="token punctuation">:</span> <span class="token string">'登录过期，请重新登录'</span><span class="token punctuation">,</span>
                       duration<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                       forbidClick<span class="token punctuation">:</span> <span class="token boolean">true</span>
                   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token comment">// 清除token</span>
                   localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'loginSuccess'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token comment">// 跳转登录页面，并将要浏览的页面fullPath传过去，登录成功后跳转需要访问的页面 </span>
                   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                        
                       router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                            
                           path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>                            
                           query<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
                               redirect<span class="token punctuation">:</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath 
                           <span class="token punctuation">}</span>                        
                       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    
                   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    
                   <span class="token keyword">break</span><span class="token punctuation">;</span> 

               <span class="token comment">// 404请求不存在</span>
               <span class="token keyword">case</span> <span class="token number">404</span><span class="token punctuation">:</span>
                   <span class="token function">Toast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                       message<span class="token punctuation">:</span> <span class="token string">'网络请求不存在'</span><span class="token punctuation">,</span>
                       duration<span class="token punctuation">:</span> <span class="token number">1500</span><span class="token punctuation">,</span>
                       forbidClick<span class="token punctuation">:</span> <span class="token boolean">true</span>
                   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>
               <span class="token comment">// 其他错误，直接抛出错误提示</span>
               <span class="token keyword">default</span><span class="token punctuation">:</span>
                   <span class="token function">Toast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                       message<span class="token punctuation">:</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
                       duration<span class="token punctuation">:</span> <span class="token number">1500</span><span class="token punctuation">,</span>
                       forbidClick<span class="token punctuation">:</span> <span class="token boolean">true</span>
                   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>响应拦截器很好理解，就是服务器返回给我们的数据，我们在拿到之前可以对他进行一些处理。例如上面的思想：如果后台返回的状态码是200，则正常返回数据，否则的根据错误的状态码类型进行一些我们需要的错误，其实这里主要就是进行了错误的统一处理和没登录或登录过期后调整登录页的一个操作。</p></blockquote> <p>要注意的是，上面的Toast()方法，是我引入的vant库中的toast轻提示组件，你根据你的ui库，对应使用你的一个提示组件。</p> <h2 id="封装get方法和post方法"><a href="#封装get方法和post方法" aria-hidden="true" class="header-anchor">#</a> 封装get方法和post方法</h2> <blockquote><p>我们常用的ajax请求方法有get、post、put等方法，相信小伙伴都不会陌生。axios对应的也有很多类似的方法，不清楚的可以看下文档。但是为了简化我们的代码，我们还是要对其进行一个简单的封装。下面我们主要封装两个方法：get和post。</p></blockquote> <blockquote><p>get方法：我们通过定义一个get函数，get函数有两个参数，第一个参数表示我们要请求的url地址，第二个参数是我们要携带的请求参数。get函数返回一个promise对象，当axios其请求成功时resolve服务器返回 值，请求失败时reject错误值。最后通过export抛出get函数。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
* get方法，对应get请求
* @param {String} url [请求的url地址]
* @param {Object} params [请求时携带的参数]
*/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>        
       axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>            
           params<span class="token punctuation">:</span> params        
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
           <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        
   <span class="token punctuation">}</span><span class="token punctuation">)</span>    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><blockquote><p>post方法：原理同get基本一样，但是要注意的是，post方法必须要使用对提交从参数对象进行序列化的操作，所以这里我们通过node的qs模块来序列化我们的参数。这个很重要，如果没有序列化操作，后台是拿不到你提交的数据的。这就是文章开头我们import QS from 'qs';的原因。如果不明白序列化是什么意思的，就百度一下吧，答案一大堆。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** 
* post方法，对应post请求 
* @param {String} url [请求的url地址] 
* @param {Object} params [请求时携带的参数] 
*/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token constant">QS</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
           <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里有个小细节说下，axios.get()方法和axios.post()在提交数据时参数的书写方式还是有区别的。区别就是，get的第二个参数是一个{}，然后这个对象的params属性值是一个参数对象的。而post的第二个参数就是一个参数对象。两者略微的区别要留意哦！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vuex/" class="prev">
          vuex
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.47140048.js" defer></script><script src="/assets/js/2.060d339d.js" defer></script><script src="/assets/js/5.5167bf59.js" defer></script>
  </body>
</html>
